<!doctype html><html lang=en dir=auto>
<head><meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta name=robots content="index, follow">
<title>Caddy å®‰è£…é…ç½®æŒ‡å—(LCMP) | è·¨å‡ºç•Œ</title>
<meta name=keywords content="guide,caddy">
<meta name=description content="0. ä»€ä¹ˆæ˜¯ Caddy

Caddy æœåŠ¡å™¨æ˜¯ä¸€ä¸ªå¼€æºçš„ï¼Œä½¿ç”¨ Golang ç¼–å†™ï¼Œæ”¯æŒ HTTP/2 çš„ Web æœåŠ¡ç«¯ã€‚å®ƒä½¿ç”¨ Golang æ ‡å‡†åº“æä¾› HTTP åŠŸèƒ½ã€‚ Caddy ä¸€ä¸ªæ˜¾è‘—çš„ç‰¹æ€§æ˜¯é»˜è®¤å¯ç”¨HTTPSã€‚å®ƒæ˜¯ç¬¬ä¸€ä¸ªæ— éœ€é¢å¤–é…ç½®å³å¯æä¾› HTTPS ç‰¹æ€§çš„Web æœåŠ¡å™¨ã€‚

ä»¥ä¸‹æ˜¯åŸºäº Ubuntu 18.04 çš„å®‰è£…è¯´æ˜ï¼š
1. å®‰è£…
ä½ å¯ä»¥ç›´æ¥ä» Download Caddy è¿™é‡Œä¸‹è½½ï¼Œé€‰æ‹©å¥½çš„ä½ å¹³å°å’Œæ’ä»¶å°±å¯ä»¥ç›´æ¥ä¸‹è½½è¿è¡Œäº†ã€‚
å½“ç„¶ï¼Œæˆ‘æ¯”è¾ƒæ¨å´‡ç¬¬äºŒç§æ–¹å¼ï¼Œå°±æ˜¯ä½¿ç”¨ https://getcaddy.com/ çš„è„šæœ¬å®‰è£…ã€‚
å®˜æ–¹ä¸æ¨è¿›ä½¿ç”¨ root æƒé™æ¥å®‰è£…è¿è¡Œ caddyï¼Œæ‰€ä»¥æˆ‘ä»¬ç›´æ¥ä½¿ç”¨æ™®é€šç”¨æˆ·æƒé™æ‰§è¡Œä»¥ä¸‹å‘½ä»¤å³å¯ã€‚
$ curl https://getcaddy.com | bash -s personal
">
<meta name=author content>
<link rel=canonical href=https://fun2ex.com/posts/caddy-install-and-setting-guide/>
<link crossorigin=anonymous href=/assets/css/stylesheet.965ee809247c56adc8031e7468de947fe8e51f1819963a7ba7e95e3007661d8b.css integrity="sha256-ll7oCSR8Vq3IAx50aN6Uf+jlHxgZljp7p+leMAdmHYs=" rel="preload stylesheet" as=style>
<script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://static.fun2ex.com/upload/a2.png/w128>
<link rel=icon type=image/png sizes=16x16 href=https://static.fun2ex.com/upload/a2.png/w16>
<link rel=icon type=image/png sizes=32x32 href=https://static.fun2ex.com/upload/a2.png/w32>
<link rel=apple-touch-icon href=https://static.fun2ex.com/upload/a2.png/w128>
<link rel=mask-icon href=https://static.fun2ex.com/upload/a2.png/w240>
<meta name=theme-color content="#2e2e33">
<meta name=msapplication-TileColor content="#2e2e33">
<noscript>
<style>#theme-toggle,.top-link{display:none}</style>
<style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style>
</noscript><meta property="og:title" content="Caddy å®‰è£…é…ç½®æŒ‡å—(LCMP)">
<meta property="og:description" content="0. ä»€ä¹ˆæ˜¯ Caddy

Caddy æœåŠ¡å™¨æ˜¯ä¸€ä¸ªå¼€æºçš„ï¼Œä½¿ç”¨ Golang ç¼–å†™ï¼Œæ”¯æŒ HTTP/2 çš„ Web æœåŠ¡ç«¯ã€‚å®ƒä½¿ç”¨ Golang æ ‡å‡†åº“æä¾› HTTP åŠŸèƒ½ã€‚ Caddy ä¸€ä¸ªæ˜¾è‘—çš„ç‰¹æ€§æ˜¯é»˜è®¤å¯ç”¨HTTPSã€‚å®ƒæ˜¯ç¬¬ä¸€ä¸ªæ— éœ€é¢å¤–é…ç½®å³å¯æä¾› HTTPS ç‰¹æ€§çš„Web æœåŠ¡å™¨ã€‚

ä»¥ä¸‹æ˜¯åŸºäº Ubuntu 18.04 çš„å®‰è£…è¯´æ˜ï¼š
1. å®‰è£…
ä½ å¯ä»¥ç›´æ¥ä» Download Caddy è¿™é‡Œä¸‹è½½ï¼Œé€‰æ‹©å¥½çš„ä½ å¹³å°å’Œæ’ä»¶å°±å¯ä»¥ç›´æ¥ä¸‹è½½è¿è¡Œäº†ã€‚
å½“ç„¶ï¼Œæˆ‘æ¯”è¾ƒæ¨å´‡ç¬¬äºŒç§æ–¹å¼ï¼Œå°±æ˜¯ä½¿ç”¨ https://getcaddy.com/ çš„è„šæœ¬å®‰è£…ã€‚
å®˜æ–¹ä¸æ¨è¿›ä½¿ç”¨ root æƒé™æ¥å®‰è£…è¿è¡Œ caddyï¼Œæ‰€ä»¥æˆ‘ä»¬ç›´æ¥ä½¿ç”¨æ™®é€šç”¨æˆ·æƒé™æ‰§è¡Œä»¥ä¸‹å‘½ä»¤å³å¯ã€‚
$ curl https://getcaddy.com | bash -s personal
">
<meta property="og:type" content="article">
<meta property="og:url" content="https://fun2ex.com/posts/caddy-install-and-setting-guide/"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2019-07-23T10:38:29+08:00">
<meta property="article:modified_time" content="2019-07-23T10:38:29+08:00">
<meta name=twitter:card content="summary">
<meta name=twitter:title content="Caddy å®‰è£…é…ç½®æŒ‡å—(LCMP)">
<meta name=twitter:description content="0. ä»€ä¹ˆæ˜¯ Caddy

Caddy æœåŠ¡å™¨æ˜¯ä¸€ä¸ªå¼€æºçš„ï¼Œä½¿ç”¨ Golang ç¼–å†™ï¼Œæ”¯æŒ HTTP/2 çš„ Web æœåŠ¡ç«¯ã€‚å®ƒä½¿ç”¨ Golang æ ‡å‡†åº“æä¾› HTTP åŠŸèƒ½ã€‚ Caddy ä¸€ä¸ªæ˜¾è‘—çš„ç‰¹æ€§æ˜¯é»˜è®¤å¯ç”¨HTTPSã€‚å®ƒæ˜¯ç¬¬ä¸€ä¸ªæ— éœ€é¢å¤–é…ç½®å³å¯æä¾› HTTPS ç‰¹æ€§çš„Web æœåŠ¡å™¨ã€‚

ä»¥ä¸‹æ˜¯åŸºäº Ubuntu 18.04 çš„å®‰è£…è¯´æ˜ï¼š
1. å®‰è£…
ä½ å¯ä»¥ç›´æ¥ä» Download Caddy è¿™é‡Œä¸‹è½½ï¼Œé€‰æ‹©å¥½çš„ä½ å¹³å°å’Œæ’ä»¶å°±å¯ä»¥ç›´æ¥ä¸‹è½½è¿è¡Œäº†ã€‚
å½“ç„¶ï¼Œæˆ‘æ¯”è¾ƒæ¨å´‡ç¬¬äºŒç§æ–¹å¼ï¼Œå°±æ˜¯ä½¿ç”¨ https://getcaddy.com/ çš„è„šæœ¬å®‰è£…ã€‚
å®˜æ–¹ä¸æ¨è¿›ä½¿ç”¨ root æƒé™æ¥å®‰è£…è¿è¡Œ caddyï¼Œæ‰€ä»¥æˆ‘ä»¬ç›´æ¥ä½¿ç”¨æ™®é€šç”¨æˆ·æƒé™æ‰§è¡Œä»¥ä¸‹å‘½ä»¤å³å¯ã€‚
$ curl https://getcaddy.com | bash -s personal
">
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://fun2ex.com/posts/"},{"@type":"ListItem","position":3,"name":"Caddy å®‰è£…é…ç½®æŒ‡å—(LCMP)","item":"https://fun2ex.com/posts/caddy-install-and-setting-guide/"}]}</script>
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Caddy å®‰è£…é…ç½®æŒ‡å—(LCMP)","name":"Caddy å®‰è£…é…ç½®æŒ‡å—(LCMP)","description":"0. ä»€ä¹ˆæ˜¯ Caddy  Caddy æœåŠ¡å™¨æ˜¯ä¸€ä¸ªå¼€æºçš„ï¼Œä½¿ç”¨ Golang ç¼–å†™ï¼Œæ”¯æŒ HTTP/2 çš„ Web æœåŠ¡ç«¯ã€‚å®ƒä½¿ç”¨ Golang æ ‡å‡†åº“æä¾› HTTP åŠŸèƒ½ã€‚ Caddy ä¸€ä¸ªæ˜¾è‘—çš„ç‰¹æ€§æ˜¯é»˜è®¤å¯ç”¨HTTPSã€‚å®ƒæ˜¯ç¬¬ä¸€ä¸ªæ— éœ€é¢å¤–é…ç½®å³å¯æä¾› HTTPS ç‰¹æ€§çš„Web æœåŠ¡å™¨ã€‚\n ä»¥ä¸‹æ˜¯åŸºäº Ubuntu 18.04 çš„å®‰è£…è¯´æ˜ï¼š\n1. å®‰è£… ä½ å¯ä»¥ç›´æ¥ä» Download Caddy è¿™é‡Œä¸‹è½½ï¼Œé€‰æ‹©å¥½çš„ä½ å¹³å°å’Œæ’ä»¶å°±å¯ä»¥ç›´æ¥ä¸‹è½½è¿è¡Œäº†ã€‚\nå½“ç„¶ï¼Œæˆ‘æ¯”è¾ƒæ¨å´‡ç¬¬äºŒç§æ–¹å¼ï¼Œå°±æ˜¯ä½¿ç”¨ https://getcaddy.com/ çš„è„šæœ¬å®‰è£…ã€‚ å®˜æ–¹ä¸æ¨è¿›ä½¿ç”¨ root æƒé™æ¥å®‰è£…è¿è¡Œ caddyï¼Œæ‰€ä»¥æˆ‘ä»¬ç›´æ¥ä½¿ç”¨æ™®é€šç”¨æˆ·æƒé™æ‰§è¡Œä»¥ä¸‹å‘½ä»¤å³å¯ã€‚\n$ curl https://getcaddy.com | bash -s personal ","keywords":["guide","caddy"],"articleBody":"0. ä»€ä¹ˆæ˜¯ Caddy  Caddy æœåŠ¡å™¨æ˜¯ä¸€ä¸ªå¼€æºçš„ï¼Œä½¿ç”¨ Golang ç¼–å†™ï¼Œæ”¯æŒ HTTP/2 çš„ Web æœåŠ¡ç«¯ã€‚å®ƒä½¿ç”¨ Golang æ ‡å‡†åº“æä¾› HTTP åŠŸèƒ½ã€‚ Caddy ä¸€ä¸ªæ˜¾è‘—çš„ç‰¹æ€§æ˜¯é»˜è®¤å¯ç”¨HTTPSã€‚å®ƒæ˜¯ç¬¬ä¸€ä¸ªæ— éœ€é¢å¤–é…ç½®å³å¯æä¾› HTTPS ç‰¹æ€§çš„Web æœåŠ¡å™¨ã€‚\n ä»¥ä¸‹æ˜¯åŸºäº Ubuntu 18.04 çš„å®‰è£…è¯´æ˜ï¼š\n1. å®‰è£… ä½ å¯ä»¥ç›´æ¥ä» Download Caddy è¿™é‡Œä¸‹è½½ï¼Œé€‰æ‹©å¥½çš„ä½ å¹³å°å’Œæ’ä»¶å°±å¯ä»¥ç›´æ¥ä¸‹è½½è¿è¡Œäº†ã€‚\nå½“ç„¶ï¼Œæˆ‘æ¯”è¾ƒæ¨å´‡ç¬¬äºŒç§æ–¹å¼ï¼Œå°±æ˜¯ä½¿ç”¨ https://getcaddy.com/ çš„è„šæœ¬å®‰è£…ã€‚ å®˜æ–¹ä¸æ¨è¿›ä½¿ç”¨ root æƒé™æ¥å®‰è£…è¿è¡Œ caddyï¼Œæ‰€ä»¥æˆ‘ä»¬ç›´æ¥ä½¿ç”¨æ™®é€šç”¨æˆ·æƒé™æ‰§è¡Œä»¥ä¸‹å‘½ä»¤å³å¯ã€‚\n$ curl https://getcaddy.com | bash -s personal Caddy æœ‰ä¸ªäººæˆæƒå’Œå•†ä¸šæˆæƒï¼Œä¸€èˆ¬ä¸ªäººä½¿ç”¨ç›´æ¥ç”¨ä¸ªäººæˆæƒç‰ˆæœ¬å°±è¡Œã€‚å•†ä¸šæˆæƒæ˜¯éœ€è¦æ”¶è´¹çš„ã€‚å¦‚æœä½ éœ€è¦å®‰è£…æ’ä»¶çš„è¯ï¼Œè¯­æ³•å¦‚ä¸‹ï¼š\n$ bash -s [personal|commercial] [plugin1,plugin2,...] [accessCode1,accessCode2...] åƒæˆ‘éœ€è¦ç”¨åˆ° http.filemanager / http.authz / http.login / http.minify / tls.dns.dnspodï¼Œå‘½ä»¤å’Œæ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š\n$ curl https://getcaddy.com | bash -s personal http.filemanager,http.authz,http.login,http.minify,tls.dns.dnspod % Total % Received % Xferd Average Speed Time Time Time Current Dload Upload Total Spent Left Speed 100 7380 100 7380 0 0 12058 0 --:--:-- --:--:-- --:--:-- 12058 Downloading Caddy for linux/amd64 (personal license)... Download verification OK Extracting... Backing up /usr/local/bin/caddy to /usr/local/bin/caddy_old (Password may be required.) Putting caddy in /usr/local/bin (may require password) Caddy 0.11.0 (non-commercial use only) Successfully installed å…³äºæ’ä»¶çš„è¯´æ˜è¯·å‚è€ƒ Caddy User Guide\n2. è¿è¡Œ ç›´æ¥åœ¨ç»ˆç«¯è„šæœ¬ä¸­æ‰§è¡Œ caddy å‘½ä»¤ï¼Œé»˜è®¤ä¼šä½¿ç”¨è„šæœ¬å½“å‰ç›®å½•ä½œä¸º web root çš„ç›®å½•ï¼Œå¹¶ä¸”ä¼šè‡ªåŠ¨ç›‘å¬ 2015 ç«¯å£è¯·æ±‚ï¼Œå¦‚ä¸‹ï¼š\n$ cd ~/home $ caddy åœ¨æµè§ˆå™¨ä¸­æ‰§è¡Œ http://localhost:2015/ ï¼Œå°±å¯ä»¥ç”¨æˆ·ç›®å½•ä¸‹é¢çš„æ–‡ä»¶äº†ã€‚\n3. é…ç½® 3.1 ä¸´æ—¶æœåŠ¡å™¨ Caddy çš„é…ç½®æ–‡ä»¶å«åšCaddyfileï¼ŒCaddy ä¸å¼ºåˆ¶ä½ æŠŠé…ç½®æ–‡ä»¶æ”¾åˆ°å“ªä¸ªç‰¹å®šæ–‡ä»¶å¤¹ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼ŒæŠŠ Caddyfile æ”¾åˆ°å½“å‰ç›®å½•å°±å¯ä»¥è·‘èµ·æ¥äº†ï¼Œå¦‚ä¸‹ï¼š\n$ echo 'localhost:8888'  Caddyfile $ echo 'gzip'  Caddyfile $ echo 'browse'  Caddyfile $ caddy 3.2 ç”Ÿæˆç¯å¢ƒé…ç½® åœ¨ç”Ÿäº§ç¯å¢ƒä½¿ç”¨çš„æ—¶å€™å°±ä¸èƒ½è¿™ä¹ˆè‰ç‡çš„æŠŠé…ç½®æ–‡ä»¶æ”¾åˆ°å½“å‰ç›®å½•äº†ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ä¼šæ”¾åˆ° /etc/caddy é‡Œã€‚\n$ sudo mkdir /etc/caddy $ sudo touch /etc/caddy/Caddyfile $ sudo chown -R root:www-data /etc/caddy é™¤äº†é…ç½®æ–‡ä»¶ï¼Œcaddy ä¼šè‡ªåŠ¨ç”Ÿæˆ ssl è¯ä¹¦ï¼Œéœ€è¦ä¸€ä¸ªæ–‡ä»¶å¤¹æ”¾ç½® ssl è¯ä¹¦ã€‚\n$ sudo mkdir /etc/ssl/caddy $ sudo chown -R www-data:root /etc/ssl/caddy $ sudo chmod 0770 /etc/ssl/caddy å› ä¸º ssl æ–‡ä»¶å¤¹é‡Œä¼šæ”¾ç½®ç§é’¥ï¼Œæ‰€ä»¥æƒé™è®¾ç½®æˆ 770 ç¦æ­¢å…¶ä»–ç”¨æˆ·è®¿é—®ã€‚ æœ€åï¼Œåˆ›å»ºä¸€ä¸‹æ”¾ç½®ç½‘ç«™æ–‡ä»¶çš„ç›®å½•ï¼Œå¦‚æœå·²ç»æœ‰äº†ï¼Œå°±ä¸éœ€è¦åˆ›å»ºäº†ã€‚\n$ sudo mkdir /var/www $ sudo chown www-data:www-data /var/www åˆ›å»ºå¥½è¿™äº›æ–‡ä»¶å’Œç›®å½•äº†ä¹‹åï¼Œæˆ‘ä»¬éœ€è¦æŠŠ caddy é…ç½®æˆä¸€ä¸ªæœåŠ¡ï¼Œè¿™æ ·å°±å¯ä»¥å¼€æœºè‡ªåŠ¨è¿è¡Œï¼Œå¹¶ä¸”ç®¡ç†èµ·æ¥ä¹Ÿæ–¹ä¾¿ã€‚å› ä¸ºç›®å‰å¤§å¤šæ•°å‘è¡Œç‰ˆéƒ½ä½¿ç”¨ systemd äº†ï¼Œæ‰€ä»¥è¿™é‡Œåªè®²ä¸€ä¸‹å¦‚ä½•é…ç½® systemdï¼Œä¸è¿‡ caddy ä¹Ÿæ”¯æŒé…ç½®æˆåŸå§‹çš„ sysvinit æœåŠ¡ï¼Œå…·ä½“æ–¹æ³• çœ‹è¿™é‡Œ ã€‚\n$ sudo curl -s https://raw.githubusercontent.com/mholt/caddy/master/dist/init/linux-systemd/caddy.service -o /etc/systemd/system/caddy.service # ä» github ä¸‹è½½ systemd é…ç½®æ–‡ä»¶ $ sudo systemctl daemon-reload # é‡æ–°åŠ è½½ systemd é…ç½® $ sudo systemctl enable caddy.service # è®¾ç½® caddy æœåŠ¡è‡ªå¯åŠ¨ $ sudo systemctl status caddy.service # æŸ¥çœ‹ caddy çŠ¶æ€ 4. Caddyfile åŸºæœ¬çš„å®‰è£…é…ç½®æå®šä¹‹åï¼Œæœ€é‡è¦çš„å°±æ˜¯å¦‚ä½•å†™ Caddyfileäº†ã€‚å¯ä»¥ç›´æ¥ vim /etc/caddy/Caddyfile æ¥ä¿®æ”¹ Caddyfileï¼Œä¹Ÿå¯ä»¥å†è‡ªå·±ç”µè„‘ä¸Šæ”¹å¥½ç„¶å rsync åˆ°æœåŠ¡å™¨ä¸Šã€‚å¦‚æœä¿®æ”¹äº† Caddyfile å‘ç°æ²¡æœ‰ç”Ÿæ•ˆï¼Œæ˜¯éœ€è¦æ‰§è¡Œä¸€ä¸‹ sudo systemctl restart caddy.service æ¥é‡å¯ caddy çš„ã€‚\n4.1 Caddyfile çš„æ ¼å¼ Caddfileçš„æ ¼å¼è¿˜æ˜¯æ¯”è¾ƒç®€å•çš„ï¼Œé¦–å…ˆç¬¬ä¸€è¡Œå¿…é¡»æ˜¯ç½‘ç«™çš„åœ°å€ï¼Œä¾‹å¦‚ï¼š\nlocalhost:8080 æˆ–\nexample.com åœ°å€å¯ä»¥å¸¦ä¸€ä¸ªç«¯å£å·ï¼Œé‚£ä¹ˆ caddy åªä¼šåœ¨è¿™ä¸ªç«¯å£ä¸Šå¼€å¯ http æœåŠ¡ï¼Œè€Œä¸ä¼šå¼€å¯ httpsï¼Œå¦‚æœä¸å†™ç«¯å£å·çš„è¯ï¼Œcaddy ä¼šé»˜è®¤ç»‘å®š 80 å’Œ 443 ç«¯å£ï¼ŒåŒæ—¶å¯åŠ¨ http å’Œ https æœåŠ¡ã€‚ åœ°å€åé¢å¯ä»¥å†è·Ÿä¸€å¤§å †æŒ‡ä»¤ï¼ˆdirectiveï¼‰ã€‚Caddyfile çš„åŸºæœ¬æ ¼å¼å°±æ˜¯è¿™æ ·ï¼Œç”±ä¸€ä¸ªç½‘ç«™åœ°å€å’ŒæŒ‡ä»¤ç»„æˆã€‚\n4.2 æŒ‡ä»¤ æŒ‡ä»¤çš„ä½œç”¨æ˜¯ä¸ºç½‘ç«™å¼€å¯æŸäº›åŠŸèƒ½ã€‚æŒ‡ä»¤çš„æ ¼å¼æœ‰ä¸‰ç§ï¼Œå…ˆè¯´ä¸€ä¸‹æœ€ç®€å•çš„ä¸å¸¦å‚æ•°çš„æŒ‡ä»¤æ¯”å¦‚ï¼š\nexample.com gzip ç¬¬äºŒè¡Œçš„ gzip å°±æ˜¯ä¸€ä¸ªæŒ‡ä»¤ï¼Œå®ƒè¡¨ç¤ºæ‰“å¼€ gzip å‹ç¼©åŠŸèƒ½ï¼Œè¿™æ ·ç½‘ç«™åœ¨ä¼ è¾“ç½‘é¡µæ˜¯å¯ä»¥é™ä½æµé‡ã€‚\nç¬¬äºŒç§æŒ‡ä»¤çš„æ ¼å¼æ˜¯å¸¦ç®€å•å‚æ•°çš„æŒ‡ä»¤ï¼š\nexample.com gzip log /var/log/caddy/example.com.access.log tls admin@ example.com.com root /var/www/ ç¬¬ä¸‰è¡Œï¼Œlog æŒ‡ä»¤ä¼šä¸ºç½‘ç«™å¼€å¯ log åŠŸèƒ½ï¼Œlog æŒ‡ä»¤åçš„å‚æ•°å‘Šè¯‰ caddy log æ–‡ä»¶å­˜æ”¾çš„ä½ç½®ã€‚ç¬¬å››è¡Œçš„ tls æŒ‡ä»¤å‘Šè¯‰ caddy ä¸ºç½‘ç«™å¼€å¯ https å¹¶è‡ªåŠ¨ç”³è¯·è¯ä¹¦ï¼Œåé¢çš„ email å‚æ•°æ˜¯å‘ŠçŸ¥ CA ç”³è¯·äººçš„é‚®ç®±ã€‚ï¼ˆcaddy ä¼šé»˜è®¤ä½¿ç”¨ letâ€™s encrypt ç”³è¯·è¯ä¹¦å¹¶ç»­çº¦ï¼‰\nå¦å¤–ï¼Œç®€å•å‚æ•°ä¹Ÿå¯èƒ½ä¸åªä¸€ä¸ªï¼Œæ¯”å¦‚ redir æŒ‡ä»¤ï¼š\nexample.com gzip log /var/log/caddy/example.com.access.log tls admin@ example.com.com root /var/www/ redir / https://lengzzz.com/archive/{uri} 301 ä¸Šé¢çš„ redir æŒ‡ä»¤å¸¦äº†ä¸‰ä¸ªå‚æ•°ï¼Œæ„æ€æ˜¯æŠŠæ‰€æœ‰çš„è¯·æ±‚ä½¿ç”¨ 301 é‡å®šå‘åˆ° https://example.com/archive/xxxï¼Œè¿™ä¸ªæŒ‡ä»¤åœ¨ç»™ç½‘ç«™æ¢åŸŸåçš„æ—¶å€™å¾ˆæœ‰ç”¨ã€‚å¦å¤– tls æŒ‡ä»¤å˜äº†ï¼Œä¸å•å•ä¼  emailä¸€ä¸ªå‚æ•°ï¼Œ è€Œæ˜¯åˆ†åˆ«ä¼ äº†è¯ä¹¦å’Œç§é’¥çš„è·¯å¾„ï¼Œè¿™æ ·çš„è¯ caddy å°±ä¸ä¼šå»è‡ªåŠ¨ç”³è¯·è¯ä¹¦ï¼Œè€Œæ˜¯ä½¿ç”¨è·¯å¾„ç»™å‡ºçš„è¯ä¹¦äº†ã€‚\nåœ¨è¿™ä¸ªä¾‹å­é‡Œè¿˜ä½¿ç”¨äº†{uri}è¿™æ ·çš„å ä½ç¬¦ï¼ˆplaceholderï¼‰ï¼Œè¯¦ç»†çš„åˆ—è¡¨å¯ä»¥åœ¨è¿™é‡ŒæŸ¥è¯¢åˆ°ï¼š https://caddyserver.com/docs/placeholders ã€‚\næœ€åä¸€ç§æŒ‡ä»¤æ˜¯å¸¦å¤æ‚å‚æ•°çš„ï¼Œè¿™ç§æŒ‡ä»¤åŒ…å«å¯èƒ½å¾ˆå¤šå‚æ•°ï¼Œæ‰€ä»¥éœ€è¦ç”¨ä¸€å¯¹èŠ±æ‹¬å·åŒ…èµ·æ¥ï¼Œæ¯”å¦‚ header æŒ‡ä»¤ï¼š\nexample.com gzip log /var/log/caddy/example.com.access.log tls admin@ example.com.com root /var/www/ header /api { Access-Control-Allow-Origin * Access-Control-Allow-Methods \"GET, POST, OPTIONS\" -Server } fastcgi / 127.0.0.1:9000 php { index index.php } rewrite { to {path} {path}/ /index.php?{query} } 6-10 è¡Œçš„ header æŒ‡ä»¤ä»£è¡¨ä¸ºæ‰€æœ‰çš„ /api/xxx çš„è¯·æ±‚åŠ ä¸Š Access-Control-Allow-Origin å’Œ Access-Control-Allow-Methods è¿™ä¸¤ä¸ª headerï¼Œä»è€Œèƒ½æ”¯æŒ javascript è·¨åŸŸè®¿é—® ï¼Œç¬¬ 9 è¡Œä»£è¡¨åˆ é™¤ Server headerï¼Œé˜²æ­¢åˆ«äººçœ‹åˆ°æœåŠ¡å™¨ç±»å‹ã€‚\n11-13 è¡Œä½¿ç”¨äº† fastcgi æŒ‡ä»¤ï¼Œä»£è¡¨æŠŠè¯·æ±‚é€šè¿‡ fastcgi ä¼ ç»™ phpï¼Œruby ç­‰åç«¯ç¨‹åºã€‚\n14-15 è¡Œï¼Œä½¿ç”¨äº† rewrite æŒ‡ä»¤ï¼Œè¿™ä¸ªæŒ‡ä»¤çš„ä½œç”¨æ˜¯æœåŠ¡å™¨å†…éƒ¨é‡å®šå‘åœ¨ä¸‹é¢çš„å‚æ•° to åé¢ï¼Œåˆè·Ÿäº†ä¸‰ä¸ªå‚æ•°ï¼Œè¿™ä¸ªåŠŸèƒ½ä¸Šæœ‰ç‚¹ç±»ä¼¼ nginx çš„try_filesã€‚å‘Šè¯‰ caddy éœ€è¦å…ˆæŸ¥çœ‹ç½‘å€æ ¹ç›®å½• /var/www é‡Œæœ‰æ²¡æœ‰ {path} å¯¹åº”çš„æ–‡ä»¶ï¼Œå¦‚æœæ²¡æœ‰å†æŸ¥çœ‹æœ‰æ²¡æœ‰ {path} å¯¹åº”çš„ç›®å½•ï¼Œå¦‚æœéƒ½æ²¡æœ‰ï¼Œåˆ™è½¬å‘ç»™ index.php å…¥å£æ–‡ä»¶ã€‚è¿™ä¸ªåŠŸèƒ½ä¸€èˆ¬ä¼šç”¨åœ¨ PHP çš„ MVC æ¡†æ¶ä¸Šä½¿ç”¨ã€‚\néšç€ä¸€æ­¥æ­¥å®Œå–„è¿™ä¸ª Caddyfileï¼Œç›®å‰è¿™ä¸ªç‰ˆæœ¬çš„ Caddyfaile å·²ç»å¯ä»¥ç›´æ¥åœ¨ç½‘ç«™ä¸­ä½¿ç”¨äº†ã€‚\n4.3 å¤š HOST ç½‘ç«™ åˆšæ‰è¯´çš„ä¸€ç›´éƒ½æ˜¯å•ä¸ªåŸŸåçš„ç½‘å€ï¼Œé‚£ä¹ˆå¦‚æœåœ¨åŒä¸€ä¸ªæœåŠ¡å™¨ä¸Šéƒ¨ç½²å¤šä¸ªåŸŸåçš„ç½‘ç«™å‘¢ï¼Ÿå¾ˆç®€å•ï¼Œåªéœ€è¦åœ¨åŸŸååé¢è·Ÿä¸€ä¸ªèŠ±æ‹¬å·æ‰©èµ·æ¥å°±å¯ä»¥äº†ï¼Œå¦‚ä¸‹ï¼š\nexample.com { gzip log /var/log/caddy/railgun_moe.log tls admin@example.com root /var/www/ header /api { Access-Control-Allow-Origin * Access-Control-Allow-Methods \"GET, POST, OPTIONS\" -Server } fastcgi / 127.0.0.1:9000 php { index index.php } rewrite { to {path} {path}/ /index.php?{query} } } assets.example.com { tls lengz@example.com log /var/log/caddy/assets.example.com.log redir / https://example.com/{uri} 301 } åˆ°è¿™é‡Œï¼ŒCaddy æœåŠ¡å·²ç»èƒ½è·‘èµ·æ¥äº†ï¼ŒåŸºæœ¬çš„ Caddy é…ç½®å°±è¿™äº›ï¼Œæ›´å¤šå†…å®¹éœ€è¦åˆ°å®˜ç½‘æ–‡æ¡£å»è‡ªè¡Œå­¦ä¹ äº†ã€‚\nCaddy User Guide\nç‰ˆæœ¬æ›´æ–° è¦å‡çº§ Caddy çš„ç‰ˆæœ¬ä¹Ÿå¾ˆç®€å•ï¼Œå°±è·Ÿå®‰è£… Caddy ä¸€æ ·ã€‚\n$ curl https://getcaddy.com | bash -s personal è¿™æ ·å°±ä¼šè‡ªåŠ¨æ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬çš„ Caddy äº†ï¼Œæ›´æ–°å®Œè®°å¾—æ‰§è¡Œä¸€ä¸‹ sudo systemctl restart caddy.service æ¥é‡å¯ caddyã€‚\nâ€”EOFâ€”\nå¼•ç”¨ä¸å…¶ä»–èµ„æ–™\n https://www.zybuluo.com/zwh8800/note/844776 Caddy - ç»´åŸºç™¾ç§‘ Caddy - The HTTP/2 Web Server with Automatic HTTPS ","wordCount":"589","inLanguage":"en","datePublished":"2019-07-23T10:38:29+08:00","dateModified":"2019-07-23T10:38:29+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://fun2ex.com/posts/caddy-install-and-setting-guide/"},"publisher":{"@type":"Organization","name":"è·¨å‡ºç•Œ","logo":{"@type":"ImageObject","url":"https://static.fun2ex.com/upload/a2.png/w128"}}}</script>
</head>
<body id=top>
<script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add('dark'):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove('dark'):window.matchMedia('(prefers-color-scheme: dark)').matches&&document.body.classList.add('dark')</script>
<header class=header>
<nav class=nav>
<div class=logo>
<a href=https://fun2ex.com accesskey=h title="è·¨å‡ºç•Œ (Alt + H)">è·¨å‡ºç•Œ</a>
<div class=logo-switches>
<button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
</button>
</div>
</div>
<ul id=menu>
<li>
<a href=https://fun2ex.com/archives/ title=Archive>
<span>Archive</span>
</a>
</li>
<li>
<a href=https://fun2ex.com/game/ title=Games>
<span>Games</span>
</a>
</li>
<li>
<a href=https://fun2ex.com/diving/ title=Diving>
<span>Diving</span>
</a>
</li>
<li>
<a href=https://fun2ex.com/link/ title=Links>
<span>Links</span>
</a>
</li>
<li>
<a href=https://fun2ex.com/tags/ title=Tags>
<span>Tags</span>
</a>
</li>
</ul>
</nav>
</header>
<main class=main>
<article class=post-single>
<header class=post-header>
<div class=breadcrumbs><a href=https://fun2ex.com>Home</a>&nbsp;Â»&nbsp;<a href=https://fun2ex.com/posts/>Posts</a></div>
<h1 class=post-title>
Caddy å®‰è£…é…ç½®æŒ‡å—(LCMP)
</h1>
<div class=post-meta><span title="2019-07-23 10:38:29 +0800 +0800">July 23, 2019</span>
</div>
</header>
<div class=post-content><h2 id=0-ä»€ä¹ˆæ˜¯-caddy>0. ä»€ä¹ˆæ˜¯ Caddy<a hidden class=anchor aria-hidden=true href=#0-ä»€ä¹ˆæ˜¯-caddy>#</a></h2>
<blockquote>
<p>Caddy æœåŠ¡å™¨æ˜¯ä¸€ä¸ªå¼€æºçš„ï¼Œä½¿ç”¨ Golang ç¼–å†™ï¼Œæ”¯æŒ HTTP/2 çš„ Web æœåŠ¡ç«¯ã€‚å®ƒä½¿ç”¨ Golang æ ‡å‡†åº“æä¾› HTTP åŠŸèƒ½ã€‚ Caddy ä¸€ä¸ªæ˜¾è‘—çš„ç‰¹æ€§æ˜¯é»˜è®¤å¯ç”¨HTTPSã€‚å®ƒæ˜¯ç¬¬ä¸€ä¸ªæ— éœ€é¢å¤–é…ç½®å³å¯æä¾› HTTPS ç‰¹æ€§çš„Web æœåŠ¡å™¨ã€‚</p>
</blockquote>
<p>ä»¥ä¸‹æ˜¯åŸºäº Ubuntu 18.04 çš„å®‰è£…è¯´æ˜ï¼š</p>
<h2 id=1-å®‰è£…>1. å®‰è£…<a hidden class=anchor aria-hidden=true href=#1-å®‰è£…>#</a></h2>
<p>ä½ å¯ä»¥ç›´æ¥ä» <a href=https://caddyserver.com/download>Download Caddy</a> è¿™é‡Œä¸‹è½½ï¼Œé€‰æ‹©å¥½çš„ä½ å¹³å°å’Œæ’ä»¶å°±å¯ä»¥ç›´æ¥ä¸‹è½½è¿è¡Œäº†ã€‚</p>
<p>å½“ç„¶ï¼Œæˆ‘æ¯”è¾ƒæ¨å´‡ç¬¬äºŒç§æ–¹å¼ï¼Œå°±æ˜¯ä½¿ç”¨ <a href=https://getcaddy.com/>https://getcaddy.com/</a> çš„è„šæœ¬å®‰è£…ã€‚
å®˜æ–¹ä¸æ¨è¿›ä½¿ç”¨ <code>root</code> æƒé™æ¥å®‰è£…è¿è¡Œ caddyï¼Œæ‰€ä»¥æˆ‘ä»¬ç›´æ¥ä½¿ç”¨æ™®é€šç”¨æˆ·æƒé™æ‰§è¡Œä»¥ä¸‹å‘½ä»¤å³å¯ã€‚</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ curl https://getcaddy.com | bash -s personal
</code></pre></div><p>Caddy æœ‰ä¸ªäººæˆæƒå’Œå•†ä¸šæˆæƒï¼Œä¸€èˆ¬ä¸ªäººä½¿ç”¨ç›´æ¥ç”¨ä¸ªäººæˆæƒç‰ˆæœ¬å°±è¡Œã€‚å•†ä¸šæˆæƒæ˜¯éœ€è¦æ”¶è´¹çš„ã€‚å¦‚æœä½ éœ€è¦å®‰è£…æ’ä»¶çš„è¯ï¼Œè¯­æ³•å¦‚ä¸‹ï¼š</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ bash -s <span style=color:#f92672>[</span>personal|commercial<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>plugin1,plugin2,...<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>accessCode1,accessCode2...<span style=color:#f92672>]</span>
</code></pre></div><p>åƒæˆ‘éœ€è¦ç”¨åˆ° <code>http.filemanager / http.authz / http.login / http.minify / tls.dns.dnspod</code>ï¼Œå‘½ä»¤å’Œæ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ curl https://getcaddy.com | bash -s personal http.filemanager,http.authz,http.login,http.minify,tls.dns.dnspod
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
<span style=color:#ae81ff>100</span>  <span style=color:#ae81ff>7380</span>  <span style=color:#ae81ff>100</span>  <span style=color:#ae81ff>7380</span>    <span style=color:#ae81ff>0</span>     <span style=color:#ae81ff>0</span>  <span style=color:#ae81ff>12058</span>      <span style=color:#ae81ff>0</span> --:--:-- --:--:-- --:--:-- <span style=color:#ae81ff>12058</span>
Downloading Caddy <span style=color:#66d9ef>for</span> linux/amd64 <span style=color:#f92672>(</span>personal license<span style=color:#f92672>)</span>...
Download verification OK
Extracting...
Backing up /usr/local/bin/caddy to /usr/local/bin/caddy_old
<span style=color:#f92672>(</span>Password may be required.<span style=color:#f92672>)</span>
Putting caddy in /usr/local/bin <span style=color:#f92672>(</span>may require password<span style=color:#f92672>)</span>
Caddy 0.11.0 <span style=color:#f92672>(</span>non-commercial use only<span style=color:#f92672>)</span>
Successfully installed
</code></pre></div><p>å…³äºæ’ä»¶çš„è¯´æ˜è¯·å‚è€ƒ <a href=https://caddyserver.com/docs>Caddy User Guide</a></p>
<h2 id=2-è¿è¡Œ>2. è¿è¡Œ<a hidden class=anchor aria-hidden=true href=#2-è¿è¡Œ>#</a></h2>
<p>ç›´æ¥åœ¨ç»ˆç«¯è„šæœ¬ä¸­æ‰§è¡Œ <code>caddy</code> å‘½ä»¤ï¼Œé»˜è®¤ä¼šä½¿ç”¨è„šæœ¬å½“å‰ç›®å½•ä½œä¸º web root çš„ç›®å½•ï¼Œå¹¶ä¸”ä¼šè‡ªåŠ¨ç›‘å¬ <code>2015</code> ç«¯å£è¯·æ±‚ï¼Œå¦‚ä¸‹ï¼š</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ cd ~/home
$ caddy
</code></pre></div><p>åœ¨æµè§ˆå™¨ä¸­æ‰§è¡Œ <code>http://localhost:2015/</code> ï¼Œå°±å¯ä»¥ç”¨æˆ·ç›®å½•ä¸‹é¢çš„æ–‡ä»¶äº†ã€‚</p>
<h2 id=3-é…ç½®>3. é…ç½®<a hidden class=anchor aria-hidden=true href=#3-é…ç½®>#</a></h2>
<h3 id=31-ä¸´æ—¶æœåŠ¡å™¨>3.1 ä¸´æ—¶æœåŠ¡å™¨<a hidden class=anchor aria-hidden=true href=#31-ä¸´æ—¶æœåŠ¡å™¨>#</a></h3>
<p>Caddy çš„é…ç½®æ–‡ä»¶å«åšCaddyfileï¼ŒCaddy ä¸å¼ºåˆ¶ä½ æŠŠé…ç½®æ–‡ä»¶æ”¾åˆ°å“ªä¸ªç‰¹å®šæ–‡ä»¶å¤¹ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼ŒæŠŠ Caddyfile æ”¾åˆ°å½“å‰ç›®å½•å°±å¯ä»¥è·‘èµ·æ¥äº†ï¼Œå¦‚ä¸‹ï¼š</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>$ echo <span style=color:#e6db74>&#39;localhost:8888&#39;</span> &gt;&gt; Caddyfile
$ echo <span style=color:#e6db74>&#39;gzip&#39;</span> &gt;&gt; Caddyfile
$ echo <span style=color:#e6db74>&#39;browse&#39;</span> &gt;&gt; Caddyfile
$ caddy
</code></pre></div><h3 id=32-ç”Ÿæˆç¯å¢ƒé…ç½®>3.2 ç”Ÿæˆç¯å¢ƒé…ç½®<a hidden class=anchor aria-hidden=true href=#32-ç”Ÿæˆç¯å¢ƒé…ç½®>#</a></h3>
<p>åœ¨ç”Ÿäº§ç¯å¢ƒä½¿ç”¨çš„æ—¶å€™å°±ä¸èƒ½è¿™ä¹ˆè‰ç‡çš„æŠŠé…ç½®æ–‡ä»¶æ”¾åˆ°å½“å‰ç›®å½•äº†ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ä¼šæ”¾åˆ° <code>/etc/caddy</code> é‡Œã€‚</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>$ sudo mkdir /etc/caddy
$ sudo touch /etc/caddy/Caddyfile
$ sudo chown -R root:www-data /etc/caddy
</code></pre></div><p>é™¤äº†é…ç½®æ–‡ä»¶ï¼Œcaddy ä¼šè‡ªåŠ¨ç”Ÿæˆ ssl è¯ä¹¦ï¼Œéœ€è¦ä¸€ä¸ªæ–‡ä»¶å¤¹æ”¾ç½® ssl è¯ä¹¦ã€‚</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>$ sudo mkdir /etc/ssl/caddy
$ sudo chown -R www-data:root /etc/ssl/caddy
$ sudo chmod <span style=color:#ae81ff>0770</span> /etc/ssl/caddy
</code></pre></div><p>å› ä¸º ssl æ–‡ä»¶å¤¹é‡Œä¼šæ”¾ç½®ç§é’¥ï¼Œæ‰€ä»¥æƒé™è®¾ç½®æˆ 770 ç¦æ­¢å…¶ä»–ç”¨æˆ·è®¿é—®ã€‚
æœ€åï¼Œåˆ›å»ºä¸€ä¸‹æ”¾ç½®ç½‘ç«™æ–‡ä»¶çš„ç›®å½•ï¼Œå¦‚æœå·²ç»æœ‰äº†ï¼Œå°±ä¸éœ€è¦åˆ›å»ºäº†ã€‚</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>$ sudo mkdir /var/www
$ sudo chown www-data:www-data /var/www
</code></pre></div><p>åˆ›å»ºå¥½è¿™äº›æ–‡ä»¶å’Œç›®å½•äº†ä¹‹åï¼Œæˆ‘ä»¬éœ€è¦æŠŠ caddy é…ç½®æˆä¸€ä¸ªæœåŠ¡ï¼Œè¿™æ ·å°±å¯ä»¥å¼€æœºè‡ªåŠ¨è¿è¡Œï¼Œå¹¶ä¸”ç®¡ç†èµ·æ¥ä¹Ÿæ–¹ä¾¿ã€‚å› ä¸ºç›®å‰å¤§å¤šæ•°å‘è¡Œç‰ˆéƒ½ä½¿ç”¨ systemd äº†ï¼Œæ‰€ä»¥è¿™é‡Œåªè®²ä¸€ä¸‹å¦‚ä½•é…ç½® systemdï¼Œä¸è¿‡ caddy ä¹Ÿæ”¯æŒé…ç½®æˆåŸå§‹çš„ sysvinit æœåŠ¡ï¼Œå…·ä½“æ–¹æ³• <a href=https://github.com/mholt/caddy/tree/master/dist/init/linux-sysvinit>çœ‹è¿™é‡Œ</a> ã€‚</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>$ sudo curl -s https://raw.githubusercontent.com/mholt/caddy/master/dist/init/linux-systemd/caddy.service -o /etc/systemd/system/caddy.service   <span style=color:#75715e># ä» github ä¸‹è½½ systemd é…ç½®æ–‡ä»¶</span>
$ sudo systemctl daemon-reload        <span style=color:#75715e># é‡æ–°åŠ è½½ systemd é…ç½®</span>
$ sudo systemctl enable caddy.service <span style=color:#75715e># è®¾ç½® caddy æœåŠ¡è‡ªå¯åŠ¨</span>
$ sudo systemctl status caddy.service <span style=color:#75715e># æŸ¥çœ‹ caddy çŠ¶æ€</span>
</code></pre></div><h2 id=4-caddyfile>4. Caddyfile<a hidden class=anchor aria-hidden=true href=#4-caddyfile>#</a></h2>
<p>åŸºæœ¬çš„å®‰è£…é…ç½®æå®šä¹‹åï¼Œæœ€é‡è¦çš„å°±æ˜¯å¦‚ä½•å†™ Caddyfileäº†ã€‚å¯ä»¥ç›´æ¥ <code>vim /etc/caddy/Caddyfile</code> æ¥ä¿®æ”¹ Caddyfileï¼Œä¹Ÿå¯ä»¥å†è‡ªå·±ç”µè„‘ä¸Šæ”¹å¥½ç„¶å rsync åˆ°æœåŠ¡å™¨ä¸Šã€‚å¦‚æœä¿®æ”¹äº† Caddyfile å‘ç°æ²¡æœ‰ç”Ÿæ•ˆï¼Œæ˜¯éœ€è¦æ‰§è¡Œä¸€ä¸‹ <code>sudo systemctl restart caddy.service</code> æ¥é‡å¯ caddy çš„ã€‚</p>
<h3 id=41-caddyfile-çš„æ ¼å¼>4.1 Caddyfile çš„æ ¼å¼<a hidden class=anchor aria-hidden=true href=#41-caddyfile-çš„æ ¼å¼>#</a></h3>
<p>Caddfileçš„æ ¼å¼è¿˜æ˜¯æ¯”è¾ƒç®€å•çš„ï¼Œé¦–å…ˆç¬¬ä¸€è¡Œå¿…é¡»æ˜¯ç½‘ç«™çš„åœ°å€ï¼Œä¾‹å¦‚ï¼š</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nginx data-lang=nginx><span style=color:#66d9ef>localhost:8080</span>
</code></pre></div><p>æˆ–</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nginx data-lang=nginx><span style=color:#66d9ef>example.com</span>
</code></pre></div><p>åœ°å€å¯ä»¥å¸¦ä¸€ä¸ªç«¯å£å·ï¼Œé‚£ä¹ˆ caddy åªä¼šåœ¨è¿™ä¸ªç«¯å£ä¸Šå¼€å¯ http æœåŠ¡ï¼Œè€Œä¸ä¼šå¼€å¯ httpsï¼Œå¦‚æœä¸å†™ç«¯å£å·çš„è¯ï¼Œcaddy ä¼šé»˜è®¤ç»‘å®š 80 å’Œ 443 ç«¯å£ï¼ŒåŒæ—¶å¯åŠ¨ http å’Œ https æœåŠ¡ã€‚
åœ°å€åé¢å¯ä»¥å†è·Ÿä¸€å¤§å †æŒ‡ä»¤ï¼ˆdirectiveï¼‰ã€‚Caddyfile çš„åŸºæœ¬æ ¼å¼å°±æ˜¯è¿™æ ·ï¼Œç”±ä¸€ä¸ªç½‘ç«™åœ°å€å’ŒæŒ‡ä»¤ç»„æˆã€‚</p>
<h3 id=42-æŒ‡ä»¤>4.2 æŒ‡ä»¤<a hidden class=anchor aria-hidden=true href=#42-æŒ‡ä»¤>#</a></h3>
<p>æŒ‡ä»¤çš„ä½œç”¨æ˜¯ä¸ºç½‘ç«™å¼€å¯æŸäº›åŠŸèƒ½ã€‚æŒ‡ä»¤çš„æ ¼å¼æœ‰ä¸‰ç§ï¼Œå…ˆè¯´ä¸€ä¸‹æœ€ç®€å•çš„ä¸å¸¦å‚æ•°çš„æŒ‡ä»¤æ¯”å¦‚ï¼š</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nginx data-lang=nginx><span style=color:#66d9ef>example.com</span>
<span style=color:#e6db74>gzip</span>
</code></pre></div><p>ç¬¬äºŒè¡Œçš„ gzip å°±æ˜¯ä¸€ä¸ªæŒ‡ä»¤ï¼Œå®ƒè¡¨ç¤ºæ‰“å¼€ gzip å‹ç¼©åŠŸèƒ½ï¼Œè¿™æ ·ç½‘ç«™åœ¨ä¼ è¾“ç½‘é¡µæ˜¯å¯ä»¥é™ä½æµé‡ã€‚</p>
<p>ç¬¬äºŒç§æŒ‡ä»¤çš„æ ¼å¼æ˜¯å¸¦ç®€å•å‚æ•°çš„æŒ‡ä»¤ï¼š</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nginx data-lang=nginx><span style=color:#66d9ef>example.com</span>
<span style=color:#e6db74>gzip</span>
<span style=color:#e6db74>log</span> <span style=color:#e6db74>/var/log/caddy/example.com.access.log</span>
<span style=color:#e6db74>tls</span> <span style=color:#e6db74>admin@</span> <span style=color:#e6db74>example.com.com</span>
<span style=color:#e6db74>root</span> <span style=color:#e6db74>/var/www/</span>
</code></pre></div><p>ç¬¬ä¸‰è¡Œï¼Œlog æŒ‡ä»¤ä¼šä¸ºç½‘ç«™å¼€å¯ log åŠŸèƒ½ï¼Œlog æŒ‡ä»¤åçš„å‚æ•°å‘Šè¯‰ caddy log æ–‡ä»¶å­˜æ”¾çš„ä½ç½®ã€‚ç¬¬å››è¡Œçš„ tls æŒ‡ä»¤å‘Šè¯‰ caddy ä¸ºç½‘ç«™å¼€å¯ https å¹¶è‡ªåŠ¨ç”³è¯·è¯ä¹¦ï¼Œåé¢çš„ email å‚æ•°æ˜¯å‘ŠçŸ¥ CA ç”³è¯·äººçš„é‚®ç®±ã€‚ï¼ˆcaddy ä¼šé»˜è®¤ä½¿ç”¨ letâ€™s encrypt ç”³è¯·è¯ä¹¦å¹¶ç»­çº¦ï¼‰</p>
<p>å¦å¤–ï¼Œç®€å•å‚æ•°ä¹Ÿå¯èƒ½ä¸åªä¸€ä¸ªï¼Œæ¯”å¦‚ redir æŒ‡ä»¤ï¼š</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nginx data-lang=nginx><span style=color:#66d9ef>example.com</span>
<span style=color:#e6db74>gzip</span>
<span style=color:#e6db74>log</span> <span style=color:#e6db74>/var/log/caddy/example.com.access.log</span>
<span style=color:#e6db74>tls</span> <span style=color:#e6db74>admin@</span> <span style=color:#e6db74>example.com.com</span>
<span style=color:#e6db74>root</span> <span style=color:#e6db74>/var/www/</span>
<span style=color:#e6db74>redir</span> <span style=color:#e6db74>/</span> <span style=color:#e6db74>https://lengzzz.com/archive/</span>{<span style=color:#f92672>uri}</span> <span style=color:#ae81ff>301</span>
</code></pre></div><p>ä¸Šé¢çš„ redir æŒ‡ä»¤å¸¦äº†ä¸‰ä¸ªå‚æ•°ï¼Œæ„æ€æ˜¯æŠŠæ‰€æœ‰çš„è¯·æ±‚ä½¿ç”¨ 301 é‡å®šå‘åˆ° <code>https://example.com/archive/xxx</code>ï¼Œè¿™ä¸ªæŒ‡ä»¤åœ¨ç»™ç½‘ç«™æ¢åŸŸåçš„æ—¶å€™å¾ˆæœ‰ç”¨ã€‚å¦å¤– tls æŒ‡ä»¤å˜äº†ï¼Œä¸å•å•ä¼  emailä¸€ä¸ªå‚æ•°ï¼Œ è€Œæ˜¯åˆ†åˆ«ä¼ äº†è¯ä¹¦å’Œç§é’¥çš„è·¯å¾„ï¼Œè¿™æ ·çš„è¯ caddy å°±ä¸ä¼šå»è‡ªåŠ¨ç”³è¯·è¯ä¹¦ï¼Œè€Œæ˜¯ä½¿ç”¨è·¯å¾„ç»™å‡ºçš„è¯ä¹¦äº†ã€‚</p>
<p>åœ¨è¿™ä¸ªä¾‹å­é‡Œè¿˜ä½¿ç”¨äº†{uri}è¿™æ ·çš„å ä½ç¬¦ï¼ˆplaceholderï¼‰ï¼Œè¯¦ç»†çš„åˆ—è¡¨å¯ä»¥åœ¨è¿™é‡ŒæŸ¥è¯¢åˆ°ï¼š <a href=https://caddyserver.com/docs/placeholders>https://caddyserver.com/docs/placeholders</a> ã€‚</p>
<p>æœ€åä¸€ç§æŒ‡ä»¤æ˜¯å¸¦å¤æ‚å‚æ•°çš„ï¼Œè¿™ç§æŒ‡ä»¤åŒ…å«å¯èƒ½å¾ˆå¤šå‚æ•°ï¼Œæ‰€ä»¥éœ€è¦ç”¨ä¸€å¯¹èŠ±æ‹¬å·åŒ…èµ·æ¥ï¼Œæ¯”å¦‚ header æŒ‡ä»¤ï¼š</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nginx data-lang=nginx><span style=color:#66d9ef>example.com</span>
<span style=color:#e6db74>gzip</span>
<span style=color:#e6db74>log</span> <span style=color:#e6db74>/var/log/caddy/example.com.access.log</span>
<span style=color:#e6db74>tls</span> <span style=color:#e6db74>admin@</span> <span style=color:#e6db74>example.com.com</span>
<span style=color:#e6db74>root</span> <span style=color:#e6db74>/var/www/</span>
<span style=color:#e6db74>header</span> <span style=color:#e6db74>/api</span> {
    <span style=color:#f92672>Access-Control-Allow-Origin</span>  <span style=color:#e6db74>*</span>
    <span style=color:#e6db74>Access-Control-Allow-Methods</span> <span style=color:#e6db74>&#34;GET,</span> <span style=color:#e6db74>POST,</span> <span style=color:#e6db74>OPTIONS&#34;</span>
    <span style=color:#e6db74>-Server</span>
<span style=color:#960050;background-color:#1e0010>}</span>
<span style=color:#e6db74>fastcgi</span> <span style=color:#e6db74>/</span> 127.0.0.1:<span style=color:#ae81ff>9000</span> <span style=color:#e6db74>php</span> {
    <span style=color:#f92672>index</span> <span style=color:#e6db74>index.php</span>
<span style=color:#960050;background-color:#1e0010>}</span>
<span style=color:#e6db74>rewrite</span> {
    <span style=color:#f92672>to</span> {<span style=color:#f92672>path}</span> {<span style=color:#f92672>path}/</span> <span style=color:#e6db74>/index.php?</span>{<span style=color:#f92672>query}</span>
<span style=color:#960050;background-color:#1e0010>}</span>
</code></pre></div><p>6-10 è¡Œçš„ header æŒ‡ä»¤ä»£è¡¨ä¸ºæ‰€æœ‰çš„ <code>/api/xxx</code> çš„è¯·æ±‚åŠ ä¸Š <code>Access-Control-Allow-Origin</code> å’Œ <code>Access-Control-Allow-Methods</code> è¿™ä¸¤ä¸ª headerï¼Œä»è€Œèƒ½æ”¯æŒ javascript <a href=https://lengzzz.com/note/cross-origin-http-request>è·¨åŸŸè®¿é—®</a> ï¼Œç¬¬ 9 è¡Œä»£è¡¨åˆ é™¤ Server headerï¼Œé˜²æ­¢åˆ«äººçœ‹åˆ°æœåŠ¡å™¨ç±»å‹ã€‚</p>
<p>11-13 è¡Œä½¿ç”¨äº† fastcgi æŒ‡ä»¤ï¼Œä»£è¡¨æŠŠè¯·æ±‚é€šè¿‡ fastcgi ä¼ ç»™ phpï¼Œruby ç­‰åç«¯ç¨‹åºã€‚</p>
<p>14-15 è¡Œï¼Œä½¿ç”¨äº† rewrite æŒ‡ä»¤ï¼Œè¿™ä¸ªæŒ‡ä»¤çš„ä½œç”¨æ˜¯<em>æœåŠ¡å™¨å†…éƒ¨é‡å®šå‘</em>åœ¨ä¸‹é¢çš„å‚æ•° <code>to</code> åé¢ï¼Œåˆè·Ÿäº†ä¸‰ä¸ªå‚æ•°ï¼Œè¿™ä¸ªåŠŸèƒ½ä¸Šæœ‰ç‚¹ç±»ä¼¼ nginx çš„try_filesã€‚å‘Šè¯‰ caddy éœ€è¦å…ˆæŸ¥çœ‹ç½‘å€æ ¹ç›®å½• <code>/var/www</code> é‡Œæœ‰æ²¡æœ‰ <code>{path}</code> å¯¹åº”çš„æ–‡ä»¶ï¼Œå¦‚æœæ²¡æœ‰å†æŸ¥çœ‹æœ‰æ²¡æœ‰ <code>{path}</code> å¯¹åº”çš„ç›®å½•ï¼Œå¦‚æœéƒ½æ²¡æœ‰ï¼Œåˆ™è½¬å‘ç»™ <code>index.php</code> å…¥å£æ–‡ä»¶ã€‚è¿™ä¸ªåŠŸèƒ½ä¸€èˆ¬ä¼šç”¨åœ¨ PHP çš„ MVC æ¡†æ¶ä¸Šä½¿ç”¨ã€‚</p>
<p>éšç€ä¸€æ­¥æ­¥å®Œå–„è¿™ä¸ª Caddyfileï¼Œç›®å‰è¿™ä¸ªç‰ˆæœ¬çš„ Caddyfaile å·²ç»å¯ä»¥ç›´æ¥åœ¨ç½‘ç«™ä¸­ä½¿ç”¨äº†ã€‚</p>
<h3 id=43-å¤š-host-ç½‘ç«™>4.3 å¤š HOST ç½‘ç«™<a hidden class=anchor aria-hidden=true href=#43-å¤š-host-ç½‘ç«™>#</a></h3>
<p>åˆšæ‰è¯´çš„ä¸€ç›´éƒ½æ˜¯å•ä¸ªåŸŸåçš„ç½‘å€ï¼Œé‚£ä¹ˆå¦‚æœåœ¨åŒä¸€ä¸ªæœåŠ¡å™¨ä¸Šéƒ¨ç½²å¤šä¸ªåŸŸåçš„ç½‘ç«™å‘¢ï¼Ÿå¾ˆç®€å•ï¼Œåªéœ€è¦åœ¨åŸŸååé¢è·Ÿä¸€ä¸ªèŠ±æ‹¬å·æ‰©èµ·æ¥å°±å¯ä»¥äº†ï¼Œå¦‚ä¸‹ï¼š</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nginx data-lang=nginx><span style=color:#66d9ef>example.com</span> {
    <span style=color:#f92672>gzip</span>
    <span style=color:#e6db74>log</span> <span style=color:#e6db74>/var/log/caddy/railgun_moe.log</span>
    <span style=color:#e6db74>tls</span> <span style=color:#e6db74>admin@example.com</span>
    <span style=color:#e6db74>root</span> <span style=color:#e6db74>/var/www/</span>
    <span style=color:#e6db74>header</span> <span style=color:#e6db74>/api</span> {
        <span style=color:#f92672>Access-Control-Allow-Origin</span>  <span style=color:#e6db74>*</span>
        <span style=color:#e6db74>Access-Control-Allow-Methods</span> <span style=color:#e6db74>&#34;GET,</span> <span style=color:#e6db74>POST,</span> <span style=color:#e6db74>OPTIONS&#34;</span>
        <span style=color:#e6db74>-Server</span>
    <span style=color:#960050;background-color:#1e0010>}</span>
    <span style=color:#e6db74>fastcgi</span> <span style=color:#e6db74>/</span> 127.0.0.1:<span style=color:#ae81ff>9000</span> <span style=color:#e6db74>php</span> {
        <span style=color:#f92672>index</span> <span style=color:#e6db74>index.php</span>
    <span style=color:#960050;background-color:#1e0010>}</span>
    <span style=color:#e6db74>rewrite</span> {
        <span style=color:#f92672>to</span> {<span style=color:#f92672>path}</span> {<span style=color:#f92672>path}/</span> <span style=color:#e6db74>/index.php?</span>{<span style=color:#f92672>query}</span>
    <span style=color:#960050;background-color:#1e0010>}</span>
<span style=color:#960050;background-color:#1e0010>}</span>
<span style=color:#e6db74>assets.example.com</span> {
    <span style=color:#f92672>tls</span> <span style=color:#e6db74>lengz@example.com</span>
    <span style=color:#e6db74>log</span> <span style=color:#e6db74>/var/log/caddy/assets.example.com.log</span>
    <span style=color:#e6db74>redir</span> <span style=color:#e6db74>/</span> <span style=color:#e6db74>https://example.com/</span>{<span style=color:#f92672>uri}</span> <span style=color:#ae81ff>301</span>
<span style=color:#960050;background-color:#1e0010>}</span>
</code></pre></div><p>åˆ°è¿™é‡Œï¼ŒCaddy æœåŠ¡å·²ç»èƒ½è·‘èµ·æ¥äº†ï¼ŒåŸºæœ¬çš„ Caddy é…ç½®å°±è¿™äº›ï¼Œæ›´å¤šå†…å®¹éœ€è¦åˆ°å®˜ç½‘æ–‡æ¡£å»è‡ªè¡Œå­¦ä¹ äº†ã€‚</p>
<p><a href=https://caddyserver.com/docs>Caddy User Guide</a></p>
<h2 id=ç‰ˆæœ¬æ›´æ–°>ç‰ˆæœ¬æ›´æ–°<a hidden class=anchor aria-hidden=true href=#ç‰ˆæœ¬æ›´æ–°>#</a></h2>
<p>è¦å‡çº§ Caddy çš„ç‰ˆæœ¬ä¹Ÿå¾ˆç®€å•ï¼Œå°±è·Ÿå®‰è£… Caddy ä¸€æ ·ã€‚</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ curl https://getcaddy.com | bash -s personal
</code></pre></div><p>è¿™æ ·å°±ä¼šè‡ªåŠ¨æ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬çš„ Caddy äº†ï¼Œæ›´æ–°å®Œè®°å¾—æ‰§è¡Œä¸€ä¸‹ <code>sudo systemctl restart caddy.service</code> æ¥é‡å¯ caddyã€‚</p>
<p>â€”EOFâ€”</p>
<p>å¼•ç”¨ä¸å…¶ä»–èµ„æ–™</p>
<ul>
<li><a href=https://www.zybuluo.com/zwh8800/note/844776>https://www.zybuluo.com/zwh8800/note/844776</a></li>
<li><a href=https://zh.wikipedia.org/wiki/Caddy>Caddy - ç»´åŸºç™¾ç§‘</a></li>
<li><a href=https://caddyserver.com/>Caddy - The HTTP/2 Web Server with Automatic HTTPS</a></li>
</ul>
</div>
<footer class=post-footer>
<ul class=post-tags>
<li><a href=https://fun2ex.com/tags/guide/>guide</a></li>
<li><a href=https://fun2ex.com/tags/caddy/>caddy</a></li>
</ul>
<nav class=paginav>
<a class=prev href=https://fun2ex.com/posts/sftpgo-setting-and-install-guide/>
<span class=title>Â« Prev</span>
<br>
<span>SFTPGo å®‰è£…é…ç½®æŒ‡å—</span>
</a>
<a class=next href=https://fun2ex.com/posts/nothing-01/>
<span class=title>Next Â»</span>
<br>
<span>è¯»åæ„Ÿ - 01</span>
</a>
</nav>
</footer><script src=https://utteranc.es/client.js repo=nikejaycn/nikejaycn.github.io issue-term=pathname label=âœ¨ğŸ’¬âœ¨ theme=photon-dark crossorigin=anonymous async></script>
</article>
</main>
<footer class=footer>
<span>&copy; 2022 <a href=https://fun2ex.com>è·¨å‡ºç•Œ</a></span>
<span>
Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a>
</span>
<div class=beian>
<a target=_blank href=https://beian.miit.gov.cn/>ç²¤ICPå¤‡18115339å·-1</a>
</div>
<div class=foreverblog>
<a href=https://www.foreverblog.cn/ target=_blank> <img src=https://static.fun2ex.com/upload/CBLVVh.png alt=foreverblog style=width:16px;height:16px></a>
<a href=https://www.foreverblog.cn/go.html target=_blank> <img src=https://static.fun2ex.com/upload/22kTLG.gif alt="foreverblog random" style=width:16px;height:16px></a>
</div>
</footer>
<a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a>
<script>let menu=document.getElementById('menu');menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${a}`)})})</script>
<script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script>
<script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove('dark'),localStorage.setItem("pref-theme",'light')):(document.body.classList.add('dark'),localStorage.setItem("pref-theme",'dark'))})</script>
<script>document.querySelectorAll('pre > code').forEach(b=>{const c=b.parentNode.parentNode,a=document.createElement('button');a.classList.add('copy-code'),a.innerText='copy';function d(){a.innerText='copied!',setTimeout(()=>{a.innerText='copy'},2e3)}a.addEventListener('click',e=>{if('clipboard'in navigator){navigator.clipboard.writeText(b.textContent),d();return}const a=document.createRange();a.selectNodeContents(b);const c=window.getSelection();c.removeAllRanges(),c.addRange(a);try{document.execCommand('copy'),d()}catch(a){}c.removeRange(a)}),c.classList.contains("highlight")?c.appendChild(a):c.parentNode.firstChild==c||(b.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?b.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(a):b.parentNode.appendChild(a))})</script></body>
</html>